// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`appendFormulas TODO constant 1`] = `
Array [
  Object {
    "meta": Object {
      "name": "foo",
      "namespaceId": "d986e871-cb85-4bd5-b675-87307f60b882",
      "richType": Object {
        "meta": Object {},
        "type": "normal",
      },
      "variableId": "1588aedf-06e1-47f1-9282-d2ffe865974c",
    },
    "task": Object {
      "async": false,
      "execEndTime": null,
      "execStartTime": null,
      "uuid": null,
      "variableValue": Object {
        "result": Object {
          "result": 123,
          "type": "number",
        },
        "runtimeEventDependencies": Array [],
        "success": true,
      },
    },
    "variableParseResult": Object {
      "async": false,
      "blockDependencies": Array [],
      "codeFragments": Array [
        Object {
          "attrs": undefined,
          "code": "Equal",
          "display": "=",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "NumberLiteral",
          "display": "123",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
      ],
      "cst": Object {
        "children": Object {
          "Equal": Array [
            Object {
              "endColumn": 1,
              "endLine": 1,
              "endOffset": 0,
              "image": "=",
              "startColumn": 1,
              "startLine": 1,
              "startOffset": 0,
              "tokenType": Object {
                "CATEGORIES": Array [
                  Object {
                    "CATEGORIES": Array [],
                    "PATTERN": /NOT_APPLICABLE/,
                    "categoryMatches": Array [
                      20,
                      21,
                      23,
                      24,
                    ],
                    "categoryMatchesMap": Object {
                      "20": true,
                      "21": true,
                      "23": true,
                      "24": true,
                    },
                    "isParent": true,
                    "name": "EqualCompareOperator",
                    "tokenTypeIdx": 3,
                  },
                ],
                "PATTERN": /=/,
                "categoryMatches": Array [],
                "categoryMatchesMap": Object {},
                "isParent": false,
                "name": "Equal",
                "tokenTypeIdx": 20,
              },
              "tokenTypeIdx": 20,
            },
          ],
          "expression": Array [
            Object {
              "children": Object {
                "lhs": Array [
                  Object {
                    "children": Object {
                      "lhs": Array [
                        Object {
                          "children": Object {
                            "lhs": Array [
                              Object {
                                "children": Object {
                                  "lhs": Array [
                                    Object {
                                      "children": Object {
                                        "lhs": Array [
                                          Object {
                                            "children": Object {
                                              "lhs": Array [
                                                Object {
                                                  "children": Object {
                                                    "lhs": Array [
                                                      Object {
                                                        "children": Object {
                                                          "lhs": Array [
                                                            Object {
                                                              "children": Object {
                                                                "lhs": Array [
                                                                  Object {
                                                                    "children": Object {
                                                                      "lhs": Array [
                                                                        Object {
                                                                          "children": Object {
                                                                            "lhs": Array [
                                                                              Object {
                                                                                "children": Object {
                                                                                  "lhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "simpleAtomicExpression": Array [
                                                                                          Object {
                                                                                            "children": Object {
                                                                                              "constantExpression": Array [
                                                                                                Object {
                                                                                                  "children": Object {
                                                                                                    "NumberLiteralExpression": Array [
                                                                                                      Object {
                                                                                                        "children": Object {
                                                                                                          "NumberLiteral": Array [
                                                                                                            Object {
                                                                                                              "endColumn": 4,
                                                                                                              "endLine": 1,
                                                                                                              "endOffset": 3,
                                                                                                              "image": "123",
                                                                                                              "startColumn": 2,
                                                                                                              "startLine": 1,
                                                                                                              "startOffset": 1,
                                                                                                              "tokenType": Object {
                                                                                                                "CATEGORIES": Array [],
                                                                                                                "PATTERN": /\\[0-9\\]\\+/,
                                                                                                                "categoryMatches": Array [],
                                                                                                                "categoryMatchesMap": Object {},
                                                                                                                "isParent": false,
                                                                                                                "name": "NumberLiteral",
                                                                                                                "tokenTypeIdx": 46,
                                                                                                              },
                                                                                                              "tokenTypeIdx": 46,
                                                                                                            },
                                                                                                          ],
                                                                                                        },
                                                                                                        "name": "NumberLiteralExpression",
                                                                                                      },
                                                                                                    ],
                                                                                                  },
                                                                                                  "name": "constantExpression",
                                                                                                },
                                                                                              ],
                                                                                            },
                                                                                            "name": "simpleAtomicExpression",
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "atomicExpression",
                                                                                    },
                                                                                  ],
                                                                                },
                                                                                "name": "chainExpression",
                                                                              },
                                                                            ],
                                                                          },
                                                                          "name": "rangeExpression",
                                                                        },
                                                                      ],
                                                                    },
                                                                    "name": "notExpression",
                                                                  },
                                                                ],
                                                              },
                                                              "name": "accessExpression",
                                                            },
                                                          ],
                                                        },
                                                        "name": "multiplicationExpression",
                                                      },
                                                    ],
                                                  },
                                                  "name": "additionExpression",
                                                },
                                              ],
                                            },
                                            "name": "concatExpression",
                                          },
                                        ],
                                      },
                                      "name": "inExpression",
                                    },
                                  ],
                                },
                                "name": "compareExpression",
                              },
                            ],
                          },
                          "name": "equalCompareExpression",
                        },
                      ],
                    },
                    "name": "combineExpression",
                  },
                ],
              },
              "name": "expression",
            },
          ],
        },
        "name": "startExpression",
      },
      "definition": "=123",
      "effect": false,
      "eventDependencies": Array [],
      "flattenVariableDependencies": Array [],
      "functionDependencies": Array [],
      "kind": "constant",
      "nameDependencies": Array [],
      "persist": false,
      "position": 0,
      "pure": true,
      "valid": true,
      "variableDependencies": Array [],
      "version": 0,
    },
  },
]
`;

exports[`appendFormulas TODO expression 1`] = `
Array [
  Object {
    "meta": Object {
      "name": "foo",
      "namespaceId": "d986e871-cb85-4bd5-b675-87307f60b882",
      "richType": Object {
        "meta": Object {},
        "type": "normal",
      },
      "variableId": "1588aedf-06e1-47f1-9282-d2ffe865974c",
    },
    "task": Object {
      "async": false,
      "execEndTime": null,
      "execStartTime": null,
      "uuid": null,
      "variableValue": Object {
        "result": Object {
          "result": 123.123,
          "type": "number",
        },
        "runtimeEventDependencies": Array [],
        "success": true,
      },
    },
    "variableParseResult": Object {
      "async": false,
      "blockDependencies": Array [],
      "codeFragments": Array [
        Object {
          "attrs": undefined,
          "code": "Equal",
          "display": "=",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Space",
          "display": " ",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "NumberLiteral",
          "display": "123",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
        Object {
          "attrs": undefined,
          "code": "Space",
          "display": " ",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Plus",
          "display": "+",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
        Object {
          "attrs": undefined,
          "code": "Space",
          "display": " ",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "NumberLiteral",
          "display": "0.123",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
      ],
      "cst": Object {
        "children": Object {
          "Equal": Array [
            Object {
              "endColumn": 1,
              "endLine": 1,
              "endOffset": 0,
              "image": "=",
              "startColumn": 1,
              "startLine": 1,
              "startOffset": 0,
              "tokenType": Object {
                "CATEGORIES": Array [
                  Object {
                    "CATEGORIES": Array [],
                    "PATTERN": /NOT_APPLICABLE/,
                    "categoryMatches": Array [
                      20,
                      21,
                      23,
                      24,
                    ],
                    "categoryMatchesMap": Object {
                      "20": true,
                      "21": true,
                      "23": true,
                      "24": true,
                    },
                    "isParent": true,
                    "name": "EqualCompareOperator",
                    "tokenTypeIdx": 3,
                  },
                ],
                "PATTERN": /=/,
                "categoryMatches": Array [],
                "categoryMatchesMap": Object {},
                "isParent": false,
                "name": "Equal",
                "tokenTypeIdx": 20,
              },
              "tokenTypeIdx": 20,
            },
          ],
          "expression": Array [
            Object {
              "children": Object {
                "lhs": Array [
                  Object {
                    "children": Object {
                      "lhs": Array [
                        Object {
                          "children": Object {
                            "lhs": Array [
                              Object {
                                "children": Object {
                                  "lhs": Array [
                                    Object {
                                      "children": Object {
                                        "lhs": Array [
                                          Object {
                                            "children": Object {
                                              "lhs": Array [
                                                Object {
                                                  "children": Object {
                                                    "AdditionOperator": Array [
                                                      Object {
                                                        "endColumn": 7,
                                                        "endLine": 1,
                                                        "endOffset": 6,
                                                        "image": "+",
                                                        "startColumn": 7,
                                                        "startLine": 1,
                                                        "startOffset": 6,
                                                        "tokenType": Object {
                                                          "CATEGORIES": Array [
                                                            Object {
                                                              "CATEGORIES": Array [],
                                                              "PATTERN": /NOT_APPLICABLE/,
                                                              "categoryMatches": Array [
                                                                27,
                                                                36,
                                                              ],
                                                              "categoryMatchesMap": Object {
                                                                "27": true,
                                                                "36": true,
                                                              },
                                                              "isParent": true,
                                                              "name": "AdditionOperator",
                                                              "tokenTypeIdx": 5,
                                                            },
                                                          ],
                                                          "PATTERN": /\\\\\\+/,
                                                          "categoryMatches": Array [],
                                                          "categoryMatchesMap": Object {},
                                                          "isParent": false,
                                                          "name": "Plus",
                                                          "tokenTypeIdx": 27,
                                                        },
                                                        "tokenTypeIdx": 27,
                                                      },
                                                    ],
                                                    "lhs": Array [
                                                      Object {
                                                        "children": Object {
                                                          "lhs": Array [
                                                            Object {
                                                              "children": Object {
                                                                "lhs": Array [
                                                                  Object {
                                                                    "children": Object {
                                                                      "lhs": Array [
                                                                        Object {
                                                                          "children": Object {
                                                                            "lhs": Array [
                                                                              Object {
                                                                                "children": Object {
                                                                                  "lhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "simpleAtomicExpression": Array [
                                                                                          Object {
                                                                                            "children": Object {
                                                                                              "constantExpression": Array [
                                                                                                Object {
                                                                                                  "children": Object {
                                                                                                    "NumberLiteralExpression": Array [
                                                                                                      Object {
                                                                                                        "children": Object {
                                                                                                          "NumberLiteral": Array [
                                                                                                            Object {
                                                                                                              "endColumn": 5,
                                                                                                              "endLine": 1,
                                                                                                              "endOffset": 4,
                                                                                                              "image": "123",
                                                                                                              "startColumn": 3,
                                                                                                              "startLine": 1,
                                                                                                              "startOffset": 2,
                                                                                                              "tokenType": Object {
                                                                                                                "CATEGORIES": Array [],
                                                                                                                "PATTERN": /\\[0-9\\]\\+/,
                                                                                                                "categoryMatches": Array [],
                                                                                                                "categoryMatchesMap": Object {},
                                                                                                                "isParent": false,
                                                                                                                "name": "NumberLiteral",
                                                                                                                "tokenTypeIdx": 46,
                                                                                                              },
                                                                                                              "tokenTypeIdx": 46,
                                                                                                            },
                                                                                                          ],
                                                                                                        },
                                                                                                        "name": "NumberLiteralExpression",
                                                                                                      },
                                                                                                    ],
                                                                                                  },
                                                                                                  "name": "constantExpression",
                                                                                                },
                                                                                              ],
                                                                                            },
                                                                                            "name": "simpleAtomicExpression",
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "atomicExpression",
                                                                                    },
                                                                                  ],
                                                                                },
                                                                                "name": "chainExpression",
                                                                              },
                                                                            ],
                                                                          },
                                                                          "name": "rangeExpression",
                                                                        },
                                                                      ],
                                                                    },
                                                                    "name": "notExpression",
                                                                  },
                                                                ],
                                                              },
                                                              "name": "accessExpression",
                                                            },
                                                          ],
                                                        },
                                                        "name": "multiplicationExpression",
                                                      },
                                                    ],
                                                    "rhs": Array [
                                                      Object {
                                                        "children": Object {
                                                          "lhs": Array [
                                                            Object {
                                                              "children": Object {
                                                                "lhs": Array [
                                                                  Object {
                                                                    "children": Object {
                                                                      "lhs": Array [
                                                                        Object {
                                                                          "children": Object {
                                                                            "lhs": Array [
                                                                              Object {
                                                                                "children": Object {
                                                                                  "lhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "simpleAtomicExpression": Array [
                                                                                          Object {
                                                                                            "children": Object {
                                                                                              "constantExpression": Array [
                                                                                                Object {
                                                                                                  "children": Object {
                                                                                                    "NumberLiteralExpression": Array [
                                                                                                      Object {
                                                                                                        "children": Object {
                                                                                                          "DecimalLiteral": Array [
                                                                                                            Object {
                                                                                                              "endColumn": 13,
                                                                                                              "endLine": 1,
                                                                                                              "endOffset": 12,
                                                                                                              "image": "0.123",
                                                                                                              "startColumn": 9,
                                                                                                              "startLine": 1,
                                                                                                              "startOffset": 8,
                                                                                                              "tokenType": Object {
                                                                                                                "CATEGORIES": Array [],
                                                                                                                "PATTERN": /\\[0-9\\]\\+\\\\\\.\\[0-9\\]\\+/,
                                                                                                                "categoryMatches": Array [],
                                                                                                                "categoryMatchesMap": Object {},
                                                                                                                "isParent": false,
                                                                                                                "name": "DecimalLiteral",
                                                                                                                "tokenTypeIdx": 47,
                                                                                                              },
                                                                                                              "tokenTypeIdx": 47,
                                                                                                            },
                                                                                                          ],
                                                                                                        },
                                                                                                        "name": "NumberLiteralExpression",
                                                                                                      },
                                                                                                    ],
                                                                                                  },
                                                                                                  "name": "constantExpression",
                                                                                                },
                                                                                              ],
                                                                                            },
                                                                                            "name": "simpleAtomicExpression",
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "atomicExpression",
                                                                                    },
                                                                                  ],
                                                                                },
                                                                                "name": "chainExpression",
                                                                              },
                                                                            ],
                                                                          },
                                                                          "name": "rangeExpression",
                                                                        },
                                                                      ],
                                                                    },
                                                                    "name": "notExpression",
                                                                  },
                                                                ],
                                                              },
                                                              "name": "accessExpression",
                                                            },
                                                          ],
                                                        },
                                                        "name": "multiplicationExpression",
                                                      },
                                                    ],
                                                  },
                                                  "name": "additionExpression",
                                                },
                                              ],
                                            },
                                            "name": "concatExpression",
                                          },
                                        ],
                                      },
                                      "name": "inExpression",
                                    },
                                  ],
                                },
                                "name": "compareExpression",
                              },
                            ],
                          },
                          "name": "equalCompareExpression",
                        },
                      ],
                    },
                    "name": "combineExpression",
                  },
                ],
              },
              "name": "expression",
            },
          ],
        },
        "name": "startExpression",
      },
      "definition": "= 123 + 0.123",
      "effect": false,
      "eventDependencies": Array [],
      "flattenVariableDependencies": Array [],
      "functionDependencies": Array [],
      "kind": "constant",
      "nameDependencies": Array [],
      "persist": false,
      "position": 0,
      "pure": true,
      "valid": true,
      "variableDependencies": Array [],
      "version": 0,
    },
  },
  Object {
    "meta": Object {
      "name": "bar",
      "namespaceId": "615d7f74-dc97-4aae-8690-b6cba1072a6a",
      "richType": Object {
        "meta": Object {},
        "type": "normal",
      },
      "variableId": "475d9e73-e52a-42b3-8a95-477596812900",
    },
    "task": Object {
      "async": false,
      "execEndTime": null,
      "execStartTime": null,
      "uuid": null,
      "variableValue": Object {
        "result": Object {
          "errorKind": "deps",
          "result": "Block not found: d986e871-cb85-4bd5-b675-87307f60b882",
          "type": "Error",
        },
        "success": false,
      },
    },
    "variableParseResult": Object {
      "async": false,
      "blockDependencies": Array [
        "d986e871-cb85-4bd5-b675-87307f60b882",
      ],
      "codeFragments": Array [
        Object {
          "attrs": undefined,
          "code": "Equal",
          "display": "=",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Function",
          "display": "ABS",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "LParen",
          "display": "(",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "NumberLiteral",
          "display": "123",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
        Object {
          "attrs": undefined,
          "code": "RParen",
          "display": ")",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
        Object {
          "attrs": undefined,
          "code": "Space",
          "display": " ",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Plus",
          "display": "+",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
        Object {
          "attrs": undefined,
          "code": "Space",
          "display": " ",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Sharp",
          "display": "#",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "UUID",
          "display": "d986e871-cb85-4bd5-b675-87307f60b882",
          "errors": Array [
            Object {
              "message": "Block not found: d986e871-cb85-4bd5-b675-87307f60b882",
              "type": "deps",
            },
          ],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Dot",
          "display": ".",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "FunctionName",
          "display": "foo",
          "errors": Array [
            Object {
              "message": "Block not found",
              "type": "syntax",
            },
          ],
          "hide": false,
          "type": "string",
        },
      ],
      "cst": Object {
        "children": Object {
          "Equal": Array [
            Object {
              "endColumn": 1,
              "endLine": 1,
              "endOffset": 0,
              "image": "=",
              "startColumn": 1,
              "startLine": 1,
              "startOffset": 0,
              "tokenType": Object {
                "CATEGORIES": Array [
                  Object {
                    "CATEGORIES": Array [],
                    "PATTERN": /NOT_APPLICABLE/,
                    "categoryMatches": Array [
                      20,
                      21,
                      23,
                      24,
                    ],
                    "categoryMatchesMap": Object {
                      "20": true,
                      "21": true,
                      "23": true,
                      "24": true,
                    },
                    "isParent": true,
                    "name": "EqualCompareOperator",
                    "tokenTypeIdx": 3,
                  },
                ],
                "PATTERN": /=/,
                "categoryMatches": Array [],
                "categoryMatchesMap": Object {},
                "isParent": false,
                "name": "Equal",
                "tokenTypeIdx": 20,
              },
              "tokenTypeIdx": 20,
            },
          ],
          "expression": Array [
            Object {
              "children": Object {
                "lhs": Array [
                  Object {
                    "children": Object {
                      "lhs": Array [
                        Object {
                          "children": Object {
                            "lhs": Array [
                              Object {
                                "children": Object {
                                  "lhs": Array [
                                    Object {
                                      "children": Object {
                                        "lhs": Array [
                                          Object {
                                            "children": Object {
                                              "lhs": Array [
                                                Object {
                                                  "children": Object {
                                                    "AdditionOperator": Array [
                                                      Object {
                                                        "endColumn": 11,
                                                        "endLine": 1,
                                                        "endOffset": 10,
                                                        "image": "+",
                                                        "startColumn": 11,
                                                        "startLine": 1,
                                                        "startOffset": 10,
                                                        "tokenType": Object {
                                                          "CATEGORIES": Array [
                                                            Object {
                                                              "CATEGORIES": Array [],
                                                              "PATTERN": /NOT_APPLICABLE/,
                                                              "categoryMatches": Array [
                                                                27,
                                                                36,
                                                              ],
                                                              "categoryMatchesMap": Object {
                                                                "27": true,
                                                                "36": true,
                                                              },
                                                              "isParent": true,
                                                              "name": "AdditionOperator",
                                                              "tokenTypeIdx": 5,
                                                            },
                                                          ],
                                                          "PATTERN": /\\\\\\+/,
                                                          "categoryMatches": Array [],
                                                          "categoryMatchesMap": Object {},
                                                          "isParent": false,
                                                          "name": "Plus",
                                                          "tokenTypeIdx": 27,
                                                        },
                                                        "tokenTypeIdx": 27,
                                                      },
                                                    ],
                                                    "lhs": Array [
                                                      Object {
                                                        "children": Object {
                                                          "lhs": Array [
                                                            Object {
                                                              "children": Object {
                                                                "lhs": Array [
                                                                  Object {
                                                                    "children": Object {
                                                                      "lhs": Array [
                                                                        Object {
                                                                          "children": Object {
                                                                            "lhs": Array [
                                                                              Object {
                                                                                "children": Object {
                                                                                  "lhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "simpleAtomicExpression": Array [
                                                                                          Object {
                                                                                            "children": Object {
                                                                                              "FunctionCall": Array [
                                                                                                Object {
                                                                                                  "children": Object {
                                                                                                    "Arguments": Array [
                                                                                                      Object {
                                                                                                        "children": Object {
                                                                                                          "expression": Array [
                                                                                                            Object {
                                                                                                              "children": Object {
                                                                                                                "lhs": Array [
                                                                                                                  Object {
                                                                                                                    "children": Object {
                                                                                                                      "lhs": Array [
                                                                                                                        Object {
                                                                                                                          "children": Object {
                                                                                                                            "lhs": Array [
                                                                                                                              Object {
                                                                                                                                "children": Object {
                                                                                                                                  "lhs": Array [
                                                                                                                                    Object {
                                                                                                                                      "children": Object {
                                                                                                                                        "lhs": Array [
                                                                                                                                          Object {
                                                                                                                                            "children": Object {
                                                                                                                                              "lhs": Array [
                                                                                                                                                Object {
                                                                                                                                                  "children": Object {
                                                                                                                                                    "lhs": Array [
                                                                                                                                                      Object {
                                                                                                                                                        "children": Object {
                                                                                                                                                          "lhs": Array [
                                                                                                                                                            Object {
                                                                                                                                                              "children": Object {
                                                                                                                                                                "lhs": Array [
                                                                                                                                                                  Object {
                                                                                                                                                                    "children": Object {
                                                                                                                                                                      "lhs": Array [
                                                                                                                                                                        Object {
                                                                                                                                                                          "children": Object {
                                                                                                                                                                            "lhs": Array [
                                                                                                                                                                              Object {
                                                                                                                                                                                "children": Object {
                                                                                                                                                                                  "lhs": Array [
                                                                                                                                                                                    Object {
                                                                                                                                                                                      "children": Object {
                                                                                                                                                                                        "simpleAtomicExpression": Array [
                                                                                                                                                                                          Object {
                                                                                                                                                                                            "children": Object {
                                                                                                                                                                                              "constantExpression": Array [
                                                                                                                                                                                                Object {
                                                                                                                                                                                                  "children": Object {
                                                                                                                                                                                                    "NumberLiteralExpression": Array [
                                                                                                                                                                                                      Object {
                                                                                                                                                                                                        "children": Object {
                                                                                                                                                                                                          "NumberLiteral": Array [
                                                                                                                                                                                                            Object {
                                                                                                                                                                                                              "endColumn": 8,
                                                                                                                                                                                                              "endLine": 1,
                                                                                                                                                                                                              "endOffset": 7,
                                                                                                                                                                                                              "image": "123",
                                                                                                                                                                                                              "startColumn": 6,
                                                                                                                                                                                                              "startLine": 1,
                                                                                                                                                                                                              "startOffset": 5,
                                                                                                                                                                                                              "tokenType": Object {
                                                                                                                                                                                                                "CATEGORIES": Array [],
                                                                                                                                                                                                                "PATTERN": /\\[0-9\\]\\+/,
                                                                                                                                                                                                                "categoryMatches": Array [],
                                                                                                                                                                                                                "categoryMatchesMap": Object {},
                                                                                                                                                                                                                "isParent": false,
                                                                                                                                                                                                                "name": "NumberLiteral",
                                                                                                                                                                                                                "tokenTypeIdx": 46,
                                                                                                                                                                                                              },
                                                                                                                                                                                                              "tokenTypeIdx": 46,
                                                                                                                                                                                                            },
                                                                                                                                                                                                          ],
                                                                                                                                                                                                        },
                                                                                                                                                                                                        "name": "NumberLiteralExpression",
                                                                                                                                                                                                      },
                                                                                                                                                                                                    ],
                                                                                                                                                                                                  },
                                                                                                                                                                                                  "name": "constantExpression",
                                                                                                                                                                                                },
                                                                                                                                                                                              ],
                                                                                                                                                                                            },
                                                                                                                                                                                            "name": "simpleAtomicExpression",
                                                                                                                                                                                          },
                                                                                                                                                                                        ],
                                                                                                                                                                                      },
                                                                                                                                                                                      "name": "atomicExpression",
                                                                                                                                                                                    },
                                                                                                                                                                                  ],
                                                                                                                                                                                },
                                                                                                                                                                                "name": "chainExpression",
                                                                                                                                                                              },
                                                                                                                                                                            ],
                                                                                                                                                                          },
                                                                                                                                                                          "name": "rangeExpression",
                                                                                                                                                                        },
                                                                                                                                                                      ],
                                                                                                                                                                    },
                                                                                                                                                                    "name": "notExpression",
                                                                                                                                                                  },
                                                                                                                                                                ],
                                                                                                                                                              },
                                                                                                                                                              "name": "accessExpression",
                                                                                                                                                            },
                                                                                                                                                          ],
                                                                                                                                                        },
                                                                                                                                                        "name": "multiplicationExpression",
                                                                                                                                                      },
                                                                                                                                                    ],
                                                                                                                                                  },
                                                                                                                                                  "name": "additionExpression",
                                                                                                                                                },
                                                                                                                                              ],
                                                                                                                                            },
                                                                                                                                            "name": "concatExpression",
                                                                                                                                          },
                                                                                                                                        ],
                                                                                                                                      },
                                                                                                                                      "name": "inExpression",
                                                                                                                                    },
                                                                                                                                  ],
                                                                                                                                },
                                                                                                                                "name": "compareExpression",
                                                                                                                              },
                                                                                                                            ],
                                                                                                                          },
                                                                                                                          "name": "equalCompareExpression",
                                                                                                                        },
                                                                                                                      ],
                                                                                                                    },
                                                                                                                    "name": "combineExpression",
                                                                                                                  },
                                                                                                                ],
                                                                                                              },
                                                                                                              "name": "expression",
                                                                                                            },
                                                                                                          ],
                                                                                                        },
                                                                                                        "name": "Arguments",
                                                                                                      },
                                                                                                    ],
                                                                                                    "FunctionName": Array [
                                                                                                      Object {
                                                                                                        "endColumn": 4,
                                                                                                        "endLine": 1,
                                                                                                        "endOffset": 3,
                                                                                                        "image": "ABS",
                                                                                                        "startColumn": 2,
                                                                                                        "startLine": 1,
                                                                                                        "startOffset": 1,
                                                                                                        "tokenType": Object {
                                                                                                          "CATEGORIES": Array [],
                                                                                                          "PATTERN": /\\[a-zA-Z_\\]\\(\\(\\?!\\[,"'\\\\\`&#@:!\\\\\\$%\\\\\\^<>/\\?\\*=\\.;~\\|\\[\\(\\)\\{\\}\\+\\\\\\\\\\\\-\\\\\\]\\\\s\\]\\)\\.\\)\\*/,
                                                                                                          "categoryMatches": Array [],
                                                                                                          "categoryMatchesMap": Object {},
                                                                                                          "isParent": false,
                                                                                                          "name": "FunctionName",
                                                                                                          "tokenTypeIdx": 55,
                                                                                                        },
                                                                                                        "tokenTypeIdx": 55,
                                                                                                      },
                                                                                                    ],
                                                                                                    "LParen": Array [
                                                                                                      Object {
                                                                                                        "endColumn": 5,
                                                                                                        "endLine": 1,
                                                                                                        "endOffset": 4,
                                                                                                        "image": "(",
                                                                                                        "startColumn": 5,
                                                                                                        "startLine": 1,
                                                                                                        "startOffset": 4,
                                                                                                        "tokenType": Object {
                                                                                                          "CATEGORIES": Array [],
                                                                                                          "PATTERN": /\\\\\\(/,
                                                                                                          "categoryMatches": Array [],
                                                                                                          "categoryMatchesMap": Object {},
                                                                                                          "isParent": false,
                                                                                                          "name": "LParen",
                                                                                                          "tokenTypeIdx": 39,
                                                                                                        },
                                                                                                        "tokenTypeIdx": 39,
                                                                                                      },
                                                                                                    ],
                                                                                                    "RParen": Array [
                                                                                                      Object {
                                                                                                        "endColumn": 9,
                                                                                                        "endLine": 1,
                                                                                                        "endOffset": 8,
                                                                                                        "image": ")",
                                                                                                        "startColumn": 9,
                                                                                                        "startLine": 1,
                                                                                                        "startOffset": 8,
                                                                                                        "tokenType": Object {
                                                                                                          "CATEGORIES": Array [],
                                                                                                          "PATTERN": /\\\\\\)/,
                                                                                                          "categoryMatches": Array [],
                                                                                                          "categoryMatchesMap": Object {},
                                                                                                          "isParent": false,
                                                                                                          "name": "RParen",
                                                                                                          "tokenTypeIdx": 40,
                                                                                                        },
                                                                                                        "tokenTypeIdx": 40,
                                                                                                      },
                                                                                                    ],
                                                                                                  },
                                                                                                  "name": "FunctionCall",
                                                                                                },
                                                                                              ],
                                                                                            },
                                                                                            "name": "simpleAtomicExpression",
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "atomicExpression",
                                                                                    },
                                                                                  ],
                                                                                },
                                                                                "name": "chainExpression",
                                                                              },
                                                                            ],
                                                                          },
                                                                          "name": "rangeExpression",
                                                                        },
                                                                      ],
                                                                    },
                                                                    "name": "notExpression",
                                                                  },
                                                                ],
                                                              },
                                                              "name": "accessExpression",
                                                            },
                                                          ],
                                                        },
                                                        "name": "multiplicationExpression",
                                                      },
                                                    ],
                                                    "rhs": Array [
                                                      Object {
                                                        "children": Object {
                                                          "lhs": Array [
                                                            Object {
                                                              "children": Object {
                                                                "lhs": Array [
                                                                  Object {
                                                                    "children": Object {
                                                                      "lhs": Array [
                                                                        Object {
                                                                          "children": Object {
                                                                            "lhs": Array [
                                                                              Object {
                                                                                "children": Object {
                                                                                  "Dot": Array [
                                                                                    Object {
                                                                                      "endColumn": 50,
                                                                                      "endLine": 1,
                                                                                      "endOffset": 49,
                                                                                      "image": ".",
                                                                                      "startColumn": 50,
                                                                                      "startLine": 1,
                                                                                      "startOffset": 49,
                                                                                      "tokenType": Object {
                                                                                        "CATEGORIES": Array [],
                                                                                        "PATTERN": /\\\\\\./,
                                                                                        "categoryMatches": Array [],
                                                                                        "categoryMatchesMap": Object {},
                                                                                        "isParent": false,
                                                                                        "name": "Dot",
                                                                                        "tokenTypeIdx": 34,
                                                                                      },
                                                                                      "tokenTypeIdx": 34,
                                                                                    },
                                                                                  ],
                                                                                  "lhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "blockExpression": Array [
                                                                                          Object {
                                                                                            "children": Object {
                                                                                              "Sharp": Array [
                                                                                                Object {
                                                                                                  "endColumn": 13,
                                                                                                  "endLine": 1,
                                                                                                  "endOffset": 12,
                                                                                                  "image": "#",
                                                                                                  "startColumn": 13,
                                                                                                  "startLine": 1,
                                                                                                  "startOffset": 12,
                                                                                                  "tokenType": Object {
                                                                                                    "CATEGORIES": Array [],
                                                                                                    "PATTERN": /#/,
                                                                                                    "categoryMatches": Array [],
                                                                                                    "categoryMatchesMap": Object {},
                                                                                                    "isParent": false,
                                                                                                    "name": "Sharp",
                                                                                                    "tokenTypeIdx": 33,
                                                                                                  },
                                                                                                  "tokenTypeIdx": 33,
                                                                                                },
                                                                                              ],
                                                                                              "UUID": Array [
                                                                                                Object {
                                                                                                  "endColumn": 49,
                                                                                                  "endLine": 1,
                                                                                                  "endOffset": 48,
                                                                                                  "image": "d986e871-cb85-4bd5-b675-87307f60b882",
                                                                                                  "startColumn": 14,
                                                                                                  "startLine": 1,
                                                                                                  "startOffset": 13,
                                                                                                  "tokenType": Object {
                                                                                                    "CATEGORIES": Array [],
                                                                                                    "PATTERN": /\\[0-9a-f\\]\\{8\\}-\\[0-9a-f\\]\\{4\\}-\\[0-9a-f\\]\\{4\\}-\\[0-9a-f\\]\\{4\\}-\\[0-9a-f\\]\\{12\\}/,
                                                                                                    "categoryMatches": Array [],
                                                                                                    "categoryMatchesMap": Object {},
                                                                                                    "isParent": false,
                                                                                                    "name": "UUID",
                                                                                                    "tokenTypeIdx": 35,
                                                                                                  },
                                                                                                  "tokenTypeIdx": 35,
                                                                                                },
                                                                                              ],
                                                                                            },
                                                                                            "name": "blockExpression",
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "atomicExpression",
                                                                                    },
                                                                                  ],
                                                                                  "rhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "FunctionName": Array [
                                                                                          Object {
                                                                                            "endColumn": 53,
                                                                                            "endLine": 1,
                                                                                            "endOffset": 52,
                                                                                            "image": "foo",
                                                                                            "startColumn": 51,
                                                                                            "startLine": 1,
                                                                                            "startOffset": 50,
                                                                                            "tokenType": Object {
                                                                                              "CATEGORIES": Array [],
                                                                                              "PATTERN": /\\[a-zA-Z_\\]\\(\\(\\?!\\[,"'\\\\\`&#@:!\\\\\\$%\\\\\\^<>/\\?\\*=\\.;~\\|\\[\\(\\)\\{\\}\\+\\\\\\\\\\\\-\\\\\\]\\\\s\\]\\)\\.\\)\\*/,
                                                                                              "categoryMatches": Array [],
                                                                                              "categoryMatchesMap": Object {},
                                                                                              "isParent": false,
                                                                                              "name": "FunctionName",
                                                                                              "tokenTypeIdx": 55,
                                                                                            },
                                                                                            "tokenTypeIdx": 55,
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "keyExpression",
                                                                                    },
                                                                                  ],
                                                                                },
                                                                                "name": "chainExpression",
                                                                              },
                                                                            ],
                                                                          },
                                                                          "name": "rangeExpression",
                                                                        },
                                                                      ],
                                                                    },
                                                                    "name": "notExpression",
                                                                  },
                                                                ],
                                                              },
                                                              "name": "accessExpression",
                                                            },
                                                          ],
                                                        },
                                                        "name": "multiplicationExpression",
                                                      },
                                                    ],
                                                  },
                                                  "name": "additionExpression",
                                                },
                                              ],
                                            },
                                            "name": "concatExpression",
                                          },
                                        ],
                                      },
                                      "name": "inExpression",
                                    },
                                  ],
                                },
                                "name": "compareExpression",
                              },
                            ],
                          },
                          "name": "equalCompareExpression",
                        },
                      ],
                    },
                    "name": "combineExpression",
                  },
                ],
              },
              "name": "expression",
            },
          ],
        },
        "name": "startExpression",
      },
      "definition": "=ABS(123) + #d986e871-cb85-4bd5-b675-87307f60b882.foo",
      "effect": false,
      "eventDependencies": Array [],
      "flattenVariableDependencies": Array [],
      "functionDependencies": Array [
        Object {
          "acceptError": false,
          "args": Array [
            Object {
              "name": "number",
              "type": "number",
            },
          ],
          "async": false,
          "chain": false,
          "description": "Returns the absolute value of a number.",
          "effect": false,
          "examples": Array [
            Object {
              "codeFragments": Array [
                Object {
                  "attrs": undefined,
                  "code": "Equal",
                  "display": "=",
                  "errors": Array [],
                  "hide": false,
                  "type": "any",
                },
                Object {
                  "attrs": undefined,
                  "code": "Function",
                  "display": "ABS",
                  "errors": Array [],
                  "hide": false,
                  "type": "any",
                },
                Object {
                  "attrs": undefined,
                  "code": "LParen",
                  "display": "(",
                  "errors": Array [],
                  "hide": false,
                  "type": "any",
                },
                Object {
                  "attrs": undefined,
                  "code": "NumberLiteral",
                  "display": "-1",
                  "errors": Array [],
                  "hide": false,
                  "type": "number",
                },
                Object {
                  "attrs": undefined,
                  "code": "RParen",
                  "display": ")",
                  "errors": Array [],
                  "hide": false,
                  "type": "number",
                },
              ],
              "input": "=ABS(-1)",
              "output": Object {
                "result": 1,
                "type": "number",
              },
            },
          ],
          "group": "core",
          "key": "ABS",
          "lazy": false,
          "name": "ABS",
          "persist": false,
          "pure": true,
          "reference": [Function],
          "returns": "number",
          "testCases": Array [
            Object {
              "input": Array [
                -1,
              ],
              "output": Object {
                "result": 1,
                "type": "number",
              },
            },
          ],
        },
      ],
      "kind": "unknown",
      "nameDependencies": Array [],
      "persist": false,
      "position": 0,
      "pure": true,
      "valid": true,
      "variableDependencies": Array [],
      "version": 0,
    },
  },
]
`;

exports[`appendFormulas TODO expression 2`] = `
Object {
  "ABS": Array [
    Object {
      "namespaceId": "615d7f74-dc97-4aae-8690-b6cba1072a6a",
      "variableId": "475d9e73-e52a-42b3-8a95-477596812900",
    },
  ],
}
`;

exports[`appendFormulas TODO expression 3`] = `Object {}`;

exports[`appendFormulas TODO parse error 1`] = `
Array [
  Object {
    "meta": Object {
      "name": "foo",
      "namespaceId": "d986e871-cb85-4bd5-b675-87307f60b882",
      "richType": Object {
        "meta": Object {},
        "type": "normal",
      },
      "variableId": "615d7f74-dc97-4aae-8690-b6cba1072a6a",
    },
    "task": Object {
      "async": false,
      "execEndTime": null,
      "execStartTime": null,
      "uuid": null,
      "variableValue": Object {
        "result": Object {
          "errorKind": "syntax",
          "result": "Missing expression",
          "type": "Error",
        },
        "success": false,
      },
    },
    "variableParseResult": Object {
      "async": false,
      "blockDependencies": Array [],
      "codeFragments": Array [
        Object {
          "attrs": undefined,
          "code": "Equal",
          "display": "=",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Space",
          "display": " ",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "NumberLiteral",
          "display": "123",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
        Object {
          "attrs": undefined,
          "code": "Space",
          "display": " ",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Plus",
          "display": "+",
          "errors": Array [
            Object {
              "message": "Missing expression",
              "type": "syntax",
            },
            Object {
              "message": "Parse error: \\"\\"",
              "type": "parse",
            },
          ],
          "hide": false,
          "type": "number",
        },
      ],
      "cst": Object {
        "children": Object {
          "Equal": Array [
            Object {
              "endColumn": 1,
              "endLine": 1,
              "endOffset": 0,
              "image": "=",
              "startColumn": 1,
              "startLine": 1,
              "startOffset": 0,
              "tokenType": Object {
                "CATEGORIES": Array [
                  Object {
                    "CATEGORIES": Array [],
                    "PATTERN": /NOT_APPLICABLE/,
                    "categoryMatches": Array [
                      20,
                      21,
                      23,
                      24,
                    ],
                    "categoryMatchesMap": Object {
                      "20": true,
                      "21": true,
                      "23": true,
                      "24": true,
                    },
                    "isParent": true,
                    "name": "EqualCompareOperator",
                    "tokenTypeIdx": 3,
                  },
                ],
                "PATTERN": /=/,
                "categoryMatches": Array [],
                "categoryMatchesMap": Object {},
                "isParent": false,
                "name": "Equal",
                "tokenTypeIdx": 20,
              },
              "tokenTypeIdx": 20,
            },
          ],
          "expression": Array [
            Object {
              "children": Object {
                "lhs": Array [
                  Object {
                    "children": Object {
                      "lhs": Array [
                        Object {
                          "children": Object {
                            "lhs": Array [
                              Object {
                                "children": Object {
                                  "lhs": Array [
                                    Object {
                                      "children": Object {
                                        "lhs": Array [
                                          Object {
                                            "children": Object {
                                              "lhs": Array [
                                                Object {
                                                  "children": Object {
                                                    "AdditionOperator": Array [
                                                      Object {
                                                        "endColumn": 7,
                                                        "endLine": 1,
                                                        "endOffset": 6,
                                                        "image": "+",
                                                        "startColumn": 7,
                                                        "startLine": 1,
                                                        "startOffset": 6,
                                                        "tokenType": Object {
                                                          "CATEGORIES": Array [
                                                            Object {
                                                              "CATEGORIES": Array [],
                                                              "PATTERN": /NOT_APPLICABLE/,
                                                              "categoryMatches": Array [
                                                                27,
                                                                36,
                                                              ],
                                                              "categoryMatchesMap": Object {
                                                                "27": true,
                                                                "36": true,
                                                              },
                                                              "isParent": true,
                                                              "name": "AdditionOperator",
                                                              "tokenTypeIdx": 5,
                                                            },
                                                          ],
                                                          "PATTERN": /\\\\\\+/,
                                                          "categoryMatches": Array [],
                                                          "categoryMatchesMap": Object {},
                                                          "isParent": false,
                                                          "name": "Plus",
                                                          "tokenTypeIdx": 27,
                                                        },
                                                        "tokenTypeIdx": 27,
                                                      },
                                                    ],
                                                    "lhs": Array [
                                                      Object {
                                                        "children": Object {
                                                          "lhs": Array [
                                                            Object {
                                                              "children": Object {
                                                                "lhs": Array [
                                                                  Object {
                                                                    "children": Object {
                                                                      "lhs": Array [
                                                                        Object {
                                                                          "children": Object {
                                                                            "lhs": Array [
                                                                              Object {
                                                                                "children": Object {
                                                                                  "lhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "simpleAtomicExpression": Array [
                                                                                          Object {
                                                                                            "children": Object {
                                                                                              "constantExpression": Array [
                                                                                                Object {
                                                                                                  "children": Object {
                                                                                                    "NumberLiteralExpression": Array [
                                                                                                      Object {
                                                                                                        "children": Object {
                                                                                                          "NumberLiteral": Array [
                                                                                                            Object {
                                                                                                              "endColumn": 5,
                                                                                                              "endLine": 1,
                                                                                                              "endOffset": 4,
                                                                                                              "image": "123",
                                                                                                              "startColumn": 3,
                                                                                                              "startLine": 1,
                                                                                                              "startOffset": 2,
                                                                                                              "tokenType": Object {
                                                                                                                "CATEGORIES": Array [],
                                                                                                                "PATTERN": /\\[0-9\\]\\+/,
                                                                                                                "categoryMatches": Array [],
                                                                                                                "categoryMatchesMap": Object {},
                                                                                                                "isParent": false,
                                                                                                                "name": "NumberLiteral",
                                                                                                                "tokenTypeIdx": 46,
                                                                                                              },
                                                                                                              "tokenTypeIdx": 46,
                                                                                                            },
                                                                                                          ],
                                                                                                        },
                                                                                                        "name": "NumberLiteralExpression",
                                                                                                      },
                                                                                                    ],
                                                                                                  },
                                                                                                  "name": "constantExpression",
                                                                                                },
                                                                                              ],
                                                                                            },
                                                                                            "name": "simpleAtomicExpression",
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "atomicExpression",
                                                                                    },
                                                                                  ],
                                                                                },
                                                                                "name": "chainExpression",
                                                                              },
                                                                            ],
                                                                          },
                                                                          "name": "rangeExpression",
                                                                        },
                                                                      ],
                                                                    },
                                                                    "name": "notExpression",
                                                                  },
                                                                ],
                                                              },
                                                              "name": "accessExpression",
                                                            },
                                                          ],
                                                        },
                                                        "name": "multiplicationExpression",
                                                      },
                                                    ],
                                                    "rhs": Array [
                                                      Object {
                                                        "children": Object {
                                                          "lhs": Array [
                                                            Object {
                                                              "children": Object {
                                                                "lhs": Array [
                                                                  Object {
                                                                    "children": Object {
                                                                      "lhs": Array [
                                                                        Object {
                                                                          "children": Object {
                                                                            "lhs": Array [
                                                                              Object {
                                                                                "children": Object {
                                                                                  "lhs": Array [
                                                                                    Object {
                                                                                      "children": Object {},
                                                                                      "name": "atomicExpression",
                                                                                      "recoveredNode": true,
                                                                                    },
                                                                                  ],
                                                                                },
                                                                                "name": "chainExpression",
                                                                                "recoveredNode": true,
                                                                              },
                                                                            ],
                                                                          },
                                                                          "name": "rangeExpression",
                                                                          "recoveredNode": true,
                                                                        },
                                                                      ],
                                                                    },
                                                                    "name": "notExpression",
                                                                    "recoveredNode": true,
                                                                  },
                                                                ],
                                                              },
                                                              "name": "accessExpression",
                                                              "recoveredNode": true,
                                                            },
                                                          ],
                                                        },
                                                        "name": "multiplicationExpression",
                                                        "recoveredNode": true,
                                                      },
                                                    ],
                                                  },
                                                  "name": "additionExpression",
                                                  "recoveredNode": true,
                                                },
                                              ],
                                            },
                                            "name": "concatExpression",
                                            "recoveredNode": true,
                                          },
                                        ],
                                      },
                                      "name": "inExpression",
                                      "recoveredNode": true,
                                    },
                                  ],
                                },
                                "name": "compareExpression",
                                "recoveredNode": true,
                              },
                            ],
                          },
                          "name": "equalCompareExpression",
                          "recoveredNode": true,
                        },
                      ],
                    },
                    "name": "combineExpression",
                    "recoveredNode": true,
                  },
                ],
              },
              "name": "expression",
              "recoveredNode": true,
            },
          ],
        },
        "name": "startExpression",
        "recoveredNode": true,
      },
      "definition": "= 123 +",
      "effect": false,
      "eventDependencies": Array [],
      "flattenVariableDependencies": Array [],
      "functionDependencies": Array [],
      "kind": "unknown",
      "nameDependencies": Array [],
      "persist": false,
      "position": 0,
      "pure": true,
      "valid": true,
      "variableDependencies": Array [],
      "version": 0,
    },
  },
]
`;

exports[`appendFormulas TODO unmatched variable 1`] = `
Array [
  Object {
    "meta": Object {
      "name": "bar",
      "namespaceId": "615d7f74-dc97-4aae-8690-b6cba1072a6a",
      "richType": Object {
        "meta": Object {},
        "type": "normal",
      },
      "variableId": "475d9e73-e52a-42b3-8a95-477596812900",
    },
    "task": Object {
      "async": false,
      "execEndTime": null,
      "execStartTime": null,
      "uuid": null,
      "variableValue": Object {
        "result": Object {
          "errorKind": "deps",
          "result": "Block not found: d986e871-cb85-4bd5-b675-87307f60b882",
          "type": "Error",
        },
        "success": false,
      },
    },
    "variableParseResult": Object {
      "async": false,
      "blockDependencies": Array [
        "d986e871-cb85-4bd5-b675-87307f60b882",
      ],
      "codeFragments": Array [
        Object {
          "attrs": undefined,
          "code": "Equal",
          "display": "=",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Function",
          "display": "ABS",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "LParen",
          "display": "(",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "NumberLiteral",
          "display": "123",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
        Object {
          "attrs": undefined,
          "code": "RParen",
          "display": ")",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
        Object {
          "attrs": undefined,
          "code": "Space",
          "display": " ",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Plus",
          "display": "+",
          "errors": Array [],
          "hide": false,
          "type": "number",
        },
        Object {
          "attrs": undefined,
          "code": "Space",
          "display": " ",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Sharp",
          "display": "#",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "UUID",
          "display": "d986e871-cb85-4bd5-b675-87307f60b882",
          "errors": Array [
            Object {
              "message": "Block not found: d986e871-cb85-4bd5-b675-87307f60b882",
              "type": "deps",
            },
          ],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "Dot",
          "display": ".",
          "errors": Array [],
          "hide": false,
          "type": "any",
        },
        Object {
          "attrs": undefined,
          "code": "FunctionName",
          "display": "foo",
          "errors": Array [
            Object {
              "message": "Block not found",
              "type": "syntax",
            },
          ],
          "hide": false,
          "type": "string",
        },
      ],
      "cst": Object {
        "children": Object {
          "Equal": Array [
            Object {
              "endColumn": 1,
              "endLine": 1,
              "endOffset": 0,
              "image": "=",
              "startColumn": 1,
              "startLine": 1,
              "startOffset": 0,
              "tokenType": Object {
                "CATEGORIES": Array [
                  Object {
                    "CATEGORIES": Array [],
                    "PATTERN": /NOT_APPLICABLE/,
                    "categoryMatches": Array [
                      20,
                      21,
                      23,
                      24,
                    ],
                    "categoryMatchesMap": Object {
                      "20": true,
                      "21": true,
                      "23": true,
                      "24": true,
                    },
                    "isParent": true,
                    "name": "EqualCompareOperator",
                    "tokenTypeIdx": 3,
                  },
                ],
                "PATTERN": /=/,
                "categoryMatches": Array [],
                "categoryMatchesMap": Object {},
                "isParent": false,
                "name": "Equal",
                "tokenTypeIdx": 20,
              },
              "tokenTypeIdx": 20,
            },
          ],
          "expression": Array [
            Object {
              "children": Object {
                "lhs": Array [
                  Object {
                    "children": Object {
                      "lhs": Array [
                        Object {
                          "children": Object {
                            "lhs": Array [
                              Object {
                                "children": Object {
                                  "lhs": Array [
                                    Object {
                                      "children": Object {
                                        "lhs": Array [
                                          Object {
                                            "children": Object {
                                              "lhs": Array [
                                                Object {
                                                  "children": Object {
                                                    "AdditionOperator": Array [
                                                      Object {
                                                        "endColumn": 11,
                                                        "endLine": 1,
                                                        "endOffset": 10,
                                                        "image": "+",
                                                        "startColumn": 11,
                                                        "startLine": 1,
                                                        "startOffset": 10,
                                                        "tokenType": Object {
                                                          "CATEGORIES": Array [
                                                            Object {
                                                              "CATEGORIES": Array [],
                                                              "PATTERN": /NOT_APPLICABLE/,
                                                              "categoryMatches": Array [
                                                                27,
                                                                36,
                                                              ],
                                                              "categoryMatchesMap": Object {
                                                                "27": true,
                                                                "36": true,
                                                              },
                                                              "isParent": true,
                                                              "name": "AdditionOperator",
                                                              "tokenTypeIdx": 5,
                                                            },
                                                          ],
                                                          "PATTERN": /\\\\\\+/,
                                                          "categoryMatches": Array [],
                                                          "categoryMatchesMap": Object {},
                                                          "isParent": false,
                                                          "name": "Plus",
                                                          "tokenTypeIdx": 27,
                                                        },
                                                        "tokenTypeIdx": 27,
                                                      },
                                                    ],
                                                    "lhs": Array [
                                                      Object {
                                                        "children": Object {
                                                          "lhs": Array [
                                                            Object {
                                                              "children": Object {
                                                                "lhs": Array [
                                                                  Object {
                                                                    "children": Object {
                                                                      "lhs": Array [
                                                                        Object {
                                                                          "children": Object {
                                                                            "lhs": Array [
                                                                              Object {
                                                                                "children": Object {
                                                                                  "lhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "simpleAtomicExpression": Array [
                                                                                          Object {
                                                                                            "children": Object {
                                                                                              "FunctionCall": Array [
                                                                                                Object {
                                                                                                  "children": Object {
                                                                                                    "Arguments": Array [
                                                                                                      Object {
                                                                                                        "children": Object {
                                                                                                          "expression": Array [
                                                                                                            Object {
                                                                                                              "children": Object {
                                                                                                                "lhs": Array [
                                                                                                                  Object {
                                                                                                                    "children": Object {
                                                                                                                      "lhs": Array [
                                                                                                                        Object {
                                                                                                                          "children": Object {
                                                                                                                            "lhs": Array [
                                                                                                                              Object {
                                                                                                                                "children": Object {
                                                                                                                                  "lhs": Array [
                                                                                                                                    Object {
                                                                                                                                      "children": Object {
                                                                                                                                        "lhs": Array [
                                                                                                                                          Object {
                                                                                                                                            "children": Object {
                                                                                                                                              "lhs": Array [
                                                                                                                                                Object {
                                                                                                                                                  "children": Object {
                                                                                                                                                    "lhs": Array [
                                                                                                                                                      Object {
                                                                                                                                                        "children": Object {
                                                                                                                                                          "lhs": Array [
                                                                                                                                                            Object {
                                                                                                                                                              "children": Object {
                                                                                                                                                                "lhs": Array [
                                                                                                                                                                  Object {
                                                                                                                                                                    "children": Object {
                                                                                                                                                                      "lhs": Array [
                                                                                                                                                                        Object {
                                                                                                                                                                          "children": Object {
                                                                                                                                                                            "lhs": Array [
                                                                                                                                                                              Object {
                                                                                                                                                                                "children": Object {
                                                                                                                                                                                  "lhs": Array [
                                                                                                                                                                                    Object {
                                                                                                                                                                                      "children": Object {
                                                                                                                                                                                        "simpleAtomicExpression": Array [
                                                                                                                                                                                          Object {
                                                                                                                                                                                            "children": Object {
                                                                                                                                                                                              "constantExpression": Array [
                                                                                                                                                                                                Object {
                                                                                                                                                                                                  "children": Object {
                                                                                                                                                                                                    "NumberLiteralExpression": Array [
                                                                                                                                                                                                      Object {
                                                                                                                                                                                                        "children": Object {
                                                                                                                                                                                                          "NumberLiteral": Array [
                                                                                                                                                                                                            Object {
                                                                                                                                                                                                              "endColumn": 8,
                                                                                                                                                                                                              "endLine": 1,
                                                                                                                                                                                                              "endOffset": 7,
                                                                                                                                                                                                              "image": "123",
                                                                                                                                                                                                              "startColumn": 6,
                                                                                                                                                                                                              "startLine": 1,
                                                                                                                                                                                                              "startOffset": 5,
                                                                                                                                                                                                              "tokenType": Object {
                                                                                                                                                                                                                "CATEGORIES": Array [],
                                                                                                                                                                                                                "PATTERN": /\\[0-9\\]\\+/,
                                                                                                                                                                                                                "categoryMatches": Array [],
                                                                                                                                                                                                                "categoryMatchesMap": Object {},
                                                                                                                                                                                                                "isParent": false,
                                                                                                                                                                                                                "name": "NumberLiteral",
                                                                                                                                                                                                                "tokenTypeIdx": 46,
                                                                                                                                                                                                              },
                                                                                                                                                                                                              "tokenTypeIdx": 46,
                                                                                                                                                                                                            },
                                                                                                                                                                                                          ],
                                                                                                                                                                                                        },
                                                                                                                                                                                                        "name": "NumberLiteralExpression",
                                                                                                                                                                                                      },
                                                                                                                                                                                                    ],
                                                                                                                                                                                                  },
                                                                                                                                                                                                  "name": "constantExpression",
                                                                                                                                                                                                },
                                                                                                                                                                                              ],
                                                                                                                                                                                            },
                                                                                                                                                                                            "name": "simpleAtomicExpression",
                                                                                                                                                                                          },
                                                                                                                                                                                        ],
                                                                                                                                                                                      },
                                                                                                                                                                                      "name": "atomicExpression",
                                                                                                                                                                                    },
                                                                                                                                                                                  ],
                                                                                                                                                                                },
                                                                                                                                                                                "name": "chainExpression",
                                                                                                                                                                              },
                                                                                                                                                                            ],
                                                                                                                                                                          },
                                                                                                                                                                          "name": "rangeExpression",
                                                                                                                                                                        },
                                                                                                                                                                      ],
                                                                                                                                                                    },
                                                                                                                                                                    "name": "notExpression",
                                                                                                                                                                  },
                                                                                                                                                                ],
                                                                                                                                                              },
                                                                                                                                                              "name": "accessExpression",
                                                                                                                                                            },
                                                                                                                                                          ],
                                                                                                                                                        },
                                                                                                                                                        "name": "multiplicationExpression",
                                                                                                                                                      },
                                                                                                                                                    ],
                                                                                                                                                  },
                                                                                                                                                  "name": "additionExpression",
                                                                                                                                                },
                                                                                                                                              ],
                                                                                                                                            },
                                                                                                                                            "name": "concatExpression",
                                                                                                                                          },
                                                                                                                                        ],
                                                                                                                                      },
                                                                                                                                      "name": "inExpression",
                                                                                                                                    },
                                                                                                                                  ],
                                                                                                                                },
                                                                                                                                "name": "compareExpression",
                                                                                                                              },
                                                                                                                            ],
                                                                                                                          },
                                                                                                                          "name": "equalCompareExpression",
                                                                                                                        },
                                                                                                                      ],
                                                                                                                    },
                                                                                                                    "name": "combineExpression",
                                                                                                                  },
                                                                                                                ],
                                                                                                              },
                                                                                                              "name": "expression",
                                                                                                            },
                                                                                                          ],
                                                                                                        },
                                                                                                        "name": "Arguments",
                                                                                                      },
                                                                                                    ],
                                                                                                    "FunctionName": Array [
                                                                                                      Object {
                                                                                                        "endColumn": 4,
                                                                                                        "endLine": 1,
                                                                                                        "endOffset": 3,
                                                                                                        "image": "ABS",
                                                                                                        "startColumn": 2,
                                                                                                        "startLine": 1,
                                                                                                        "startOffset": 1,
                                                                                                        "tokenType": Object {
                                                                                                          "CATEGORIES": Array [],
                                                                                                          "PATTERN": /\\[a-zA-Z_\\]\\(\\(\\?!\\[,"'\\\\\`&#@:!\\\\\\$%\\\\\\^<>/\\?\\*=\\.;~\\|\\[\\(\\)\\{\\}\\+\\\\\\\\\\\\-\\\\\\]\\\\s\\]\\)\\.\\)\\*/,
                                                                                                          "categoryMatches": Array [],
                                                                                                          "categoryMatchesMap": Object {},
                                                                                                          "isParent": false,
                                                                                                          "name": "FunctionName",
                                                                                                          "tokenTypeIdx": 55,
                                                                                                        },
                                                                                                        "tokenTypeIdx": 55,
                                                                                                      },
                                                                                                    ],
                                                                                                    "LParen": Array [
                                                                                                      Object {
                                                                                                        "endColumn": 5,
                                                                                                        "endLine": 1,
                                                                                                        "endOffset": 4,
                                                                                                        "image": "(",
                                                                                                        "startColumn": 5,
                                                                                                        "startLine": 1,
                                                                                                        "startOffset": 4,
                                                                                                        "tokenType": Object {
                                                                                                          "CATEGORIES": Array [],
                                                                                                          "PATTERN": /\\\\\\(/,
                                                                                                          "categoryMatches": Array [],
                                                                                                          "categoryMatchesMap": Object {},
                                                                                                          "isParent": false,
                                                                                                          "name": "LParen",
                                                                                                          "tokenTypeIdx": 39,
                                                                                                        },
                                                                                                        "tokenTypeIdx": 39,
                                                                                                      },
                                                                                                    ],
                                                                                                    "RParen": Array [
                                                                                                      Object {
                                                                                                        "endColumn": 9,
                                                                                                        "endLine": 1,
                                                                                                        "endOffset": 8,
                                                                                                        "image": ")",
                                                                                                        "startColumn": 9,
                                                                                                        "startLine": 1,
                                                                                                        "startOffset": 8,
                                                                                                        "tokenType": Object {
                                                                                                          "CATEGORIES": Array [],
                                                                                                          "PATTERN": /\\\\\\)/,
                                                                                                          "categoryMatches": Array [],
                                                                                                          "categoryMatchesMap": Object {},
                                                                                                          "isParent": false,
                                                                                                          "name": "RParen",
                                                                                                          "tokenTypeIdx": 40,
                                                                                                        },
                                                                                                        "tokenTypeIdx": 40,
                                                                                                      },
                                                                                                    ],
                                                                                                  },
                                                                                                  "name": "FunctionCall",
                                                                                                },
                                                                                              ],
                                                                                            },
                                                                                            "name": "simpleAtomicExpression",
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "atomicExpression",
                                                                                    },
                                                                                  ],
                                                                                },
                                                                                "name": "chainExpression",
                                                                              },
                                                                            ],
                                                                          },
                                                                          "name": "rangeExpression",
                                                                        },
                                                                      ],
                                                                    },
                                                                    "name": "notExpression",
                                                                  },
                                                                ],
                                                              },
                                                              "name": "accessExpression",
                                                            },
                                                          ],
                                                        },
                                                        "name": "multiplicationExpression",
                                                      },
                                                    ],
                                                    "rhs": Array [
                                                      Object {
                                                        "children": Object {
                                                          "lhs": Array [
                                                            Object {
                                                              "children": Object {
                                                                "lhs": Array [
                                                                  Object {
                                                                    "children": Object {
                                                                      "lhs": Array [
                                                                        Object {
                                                                          "children": Object {
                                                                            "lhs": Array [
                                                                              Object {
                                                                                "children": Object {
                                                                                  "Dot": Array [
                                                                                    Object {
                                                                                      "endColumn": 50,
                                                                                      "endLine": 1,
                                                                                      "endOffset": 49,
                                                                                      "image": ".",
                                                                                      "startColumn": 50,
                                                                                      "startLine": 1,
                                                                                      "startOffset": 49,
                                                                                      "tokenType": Object {
                                                                                        "CATEGORIES": Array [],
                                                                                        "PATTERN": /\\\\\\./,
                                                                                        "categoryMatches": Array [],
                                                                                        "categoryMatchesMap": Object {},
                                                                                        "isParent": false,
                                                                                        "name": "Dot",
                                                                                        "tokenTypeIdx": 34,
                                                                                      },
                                                                                      "tokenTypeIdx": 34,
                                                                                    },
                                                                                  ],
                                                                                  "lhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "blockExpression": Array [
                                                                                          Object {
                                                                                            "children": Object {
                                                                                              "Sharp": Array [
                                                                                                Object {
                                                                                                  "endColumn": 13,
                                                                                                  "endLine": 1,
                                                                                                  "endOffset": 12,
                                                                                                  "image": "#",
                                                                                                  "startColumn": 13,
                                                                                                  "startLine": 1,
                                                                                                  "startOffset": 12,
                                                                                                  "tokenType": Object {
                                                                                                    "CATEGORIES": Array [],
                                                                                                    "PATTERN": /#/,
                                                                                                    "categoryMatches": Array [],
                                                                                                    "categoryMatchesMap": Object {},
                                                                                                    "isParent": false,
                                                                                                    "name": "Sharp",
                                                                                                    "tokenTypeIdx": 33,
                                                                                                  },
                                                                                                  "tokenTypeIdx": 33,
                                                                                                },
                                                                                              ],
                                                                                              "UUID": Array [
                                                                                                Object {
                                                                                                  "endColumn": 49,
                                                                                                  "endLine": 1,
                                                                                                  "endOffset": 48,
                                                                                                  "image": "d986e871-cb85-4bd5-b675-87307f60b882",
                                                                                                  "startColumn": 14,
                                                                                                  "startLine": 1,
                                                                                                  "startOffset": 13,
                                                                                                  "tokenType": Object {
                                                                                                    "CATEGORIES": Array [],
                                                                                                    "PATTERN": /\\[0-9a-f\\]\\{8\\}-\\[0-9a-f\\]\\{4\\}-\\[0-9a-f\\]\\{4\\}-\\[0-9a-f\\]\\{4\\}-\\[0-9a-f\\]\\{12\\}/,
                                                                                                    "categoryMatches": Array [],
                                                                                                    "categoryMatchesMap": Object {},
                                                                                                    "isParent": false,
                                                                                                    "name": "UUID",
                                                                                                    "tokenTypeIdx": 35,
                                                                                                  },
                                                                                                  "tokenTypeIdx": 35,
                                                                                                },
                                                                                              ],
                                                                                            },
                                                                                            "name": "blockExpression",
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "atomicExpression",
                                                                                    },
                                                                                  ],
                                                                                  "rhs": Array [
                                                                                    Object {
                                                                                      "children": Object {
                                                                                        "FunctionName": Array [
                                                                                          Object {
                                                                                            "endColumn": 53,
                                                                                            "endLine": 1,
                                                                                            "endOffset": 52,
                                                                                            "image": "foo",
                                                                                            "startColumn": 51,
                                                                                            "startLine": 1,
                                                                                            "startOffset": 50,
                                                                                            "tokenType": Object {
                                                                                              "CATEGORIES": Array [],
                                                                                              "PATTERN": /\\[a-zA-Z_\\]\\(\\(\\?!\\[,"'\\\\\`&#@:!\\\\\\$%\\\\\\^<>/\\?\\*=\\.;~\\|\\[\\(\\)\\{\\}\\+\\\\\\\\\\\\-\\\\\\]\\\\s\\]\\)\\.\\)\\*/,
                                                                                              "categoryMatches": Array [],
                                                                                              "categoryMatchesMap": Object {},
                                                                                              "isParent": false,
                                                                                              "name": "FunctionName",
                                                                                              "tokenTypeIdx": 55,
                                                                                            },
                                                                                            "tokenTypeIdx": 55,
                                                                                          },
                                                                                        ],
                                                                                      },
                                                                                      "name": "keyExpression",
                                                                                    },
                                                                                  ],
                                                                                },
                                                                                "name": "chainExpression",
                                                                              },
                                                                            ],
                                                                          },
                                                                          "name": "rangeExpression",
                                                                        },
                                                                      ],
                                                                    },
                                                                    "name": "notExpression",
                                                                  },
                                                                ],
                                                              },
                                                              "name": "accessExpression",
                                                            },
                                                          ],
                                                        },
                                                        "name": "multiplicationExpression",
                                                      },
                                                    ],
                                                  },
                                                  "name": "additionExpression",
                                                },
                                              ],
                                            },
                                            "name": "concatExpression",
                                          },
                                        ],
                                      },
                                      "name": "inExpression",
                                    },
                                  ],
                                },
                                "name": "compareExpression",
                              },
                            ],
                          },
                          "name": "equalCompareExpression",
                        },
                      ],
                    },
                    "name": "combineExpression",
                  },
                ],
              },
              "name": "expression",
            },
          ],
        },
        "name": "startExpression",
      },
      "definition": "=ABS(123) + #d986e871-cb85-4bd5-b675-87307f60b882.foo",
      "effect": false,
      "eventDependencies": Array [],
      "flattenVariableDependencies": Array [],
      "functionDependencies": Array [
        Object {
          "acceptError": false,
          "args": Array [
            Object {
              "name": "number",
              "type": "number",
            },
          ],
          "async": false,
          "chain": false,
          "description": "Returns the absolute value of a number.",
          "effect": false,
          "examples": Array [
            Object {
              "codeFragments": Array [
                Object {
                  "attrs": undefined,
                  "code": "Equal",
                  "display": "=",
                  "errors": Array [],
                  "hide": false,
                  "type": "any",
                },
                Object {
                  "attrs": undefined,
                  "code": "Function",
                  "display": "ABS",
                  "errors": Array [],
                  "hide": false,
                  "type": "any",
                },
                Object {
                  "attrs": undefined,
                  "code": "LParen",
                  "display": "(",
                  "errors": Array [],
                  "hide": false,
                  "type": "any",
                },
                Object {
                  "attrs": undefined,
                  "code": "NumberLiteral",
                  "display": "-1",
                  "errors": Array [],
                  "hide": false,
                  "type": "number",
                },
                Object {
                  "attrs": undefined,
                  "code": "RParen",
                  "display": ")",
                  "errors": Array [],
                  "hide": false,
                  "type": "number",
                },
              ],
              "input": "=ABS(-1)",
              "output": Object {
                "result": 1,
                "type": "number",
              },
            },
          ],
          "group": "core",
          "key": "ABS",
          "lazy": false,
          "name": "ABS",
          "persist": false,
          "pure": true,
          "reference": [Function],
          "returns": "number",
          "testCases": Array [
            Object {
              "input": Array [
                -1,
              ],
              "output": Object {
                "result": 1,
                "type": "number",
              },
            },
          ],
        },
      ],
      "kind": "unknown",
      "nameDependencies": Array [],
      "persist": false,
      "position": 0,
      "pure": true,
      "valid": true,
      "variableDependencies": Array [],
      "version": 0,
    },
  },
]
`;
